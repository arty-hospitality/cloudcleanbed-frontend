<div class="kanban-container">
  <!-- Header -->
  <div class="kanban-header">
    <h1>Housekeeping Dashboard</h1>
    <div class="header-stats">
      <span class="stat">Total Rooms: {{ kanbanService.tasks().length }}</span>
      <span class="stat" *ngIf="kanbanService.loading()">Loading...</span>
      <span class="stat error" *ngIf="kanbanService.error()">{{ kanbanService.error() }}</span>
    </div>
  </div>

  <div class="kanban-board">
    <div 
      class="kanban-column" 
      *ngFor="let column of organizedColumns(); trackBy: trackByColumnId"
      [style.border-top-color]="column.color">
      
      <div class="column-header" [style.background-color]="column.color">
        <h3>{{ column.title }}</h3>
        <span class="task-count">{{ column.tasks.length }}</span>
      </div>

      <div
        class="task-list"
        cdkDropList
        [cdkDropListData]="column.tasks"
        [id]="column.id"
        [cdkDropListConnectedTo]="organizedColumns().map(c => c.id)"
        (cdkDropListDropped)="onDrop($event, column.id)">
        
        <div
          class="task-card"
          *ngFor="let task of column.tasks; trackBy: trackByTaskId"
          cdkDrag>
        
          <div class="drag-handle" cdkDragHandle>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <circle cx="4" cy="4" r="1.5"/>
              <circle cx="4" cy="8" r="1.5"/>
              <circle cx="4" cy="12" r="1.5"/>
              <circle cx="12" cy="4" r="1.5"/>
              <circle cx="12" cy="8" r="1.5"/>
              <circle cx="12" cy="12" r="1.5"/>
            </svg>
          </div>

          <div class="task-content">
            <div class="task-header">
              <h4 class="room-number">Room {{ task.room_number }}</h4>
              <span 
                class="priority-badge" 
                [ngClass]="getPriorityColor(task.priority)">
                {{ task.priority }}
              </span>
            </div>

            <div class="task-details">
              <span class="detail" *ngIf="task.floor">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                </svg>
                Floor {{ task.floor }}
              </span>

              <span class="detail" *ngIf="task.room_type">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2"/>
                </svg>
                {{ task.room_type }}
              </span>

              <span class="detail" *ngIf="task.assigned_to">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                {{ task.assigned_to }}
              </span>

              <span class="detail" *ngIf="task.estimated_minutes">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
                {{ task.estimated_minutes }} min
              </span>
            </div>

            <p class="task-notes" *ngIf="task.notes">{{ task.notes }}</p>
          </div>

          <div class="task-card drag-preview" *cdkDragPreview>
            <div class="task-content">
              <h4 class="room-number">Room {{ task.room_number }}</h4>
            </div>
          </div>
        </div>

        <div class="empty-state" *ngIf="column.tasks.length === 0">
          <p>No rooms in {{ column.title.toLowerCase() }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
